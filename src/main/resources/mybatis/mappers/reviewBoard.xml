<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reviewBoard">

	<!-- 2021.09.30 by 원호 -->
	<!-- 후기게시판 리스트 -->
	<select id = "reviewBoardList" parameterType = "Map" resultType = "ReviewBoardVo">
		<![CDATA[
			select  rt.rn,
					rt.reviewNo,
			        rt.reviewTitle,
			        rt.nickname,
			        rt.reviewhit,
			        rt.reviewLike,
			        rt.reviewregdate,
			        rt.userno,
			        rt.reviewImg
			from (select  rownum rn,
						  ot.reviewNo,
			              ot.reviewTitle,
			              ot.nickname,
			              ot.reviewhit,
			              ot.reviewLike,
			              ot.reviewregdate,
			              ot.userno,
			              ot.reviewImg
			      from (select  r.reviewNo,
			      				r.reviewTitle,
			                    u.nickname,
			                    r.reviewhit,
			                    r.reviewLike,
			                    to_char(r.reviewregdate, 'yy-mm-dd') reviewregdate,
			                    r.userno,
			                    r.reviewImg
			            from review r, users u
			            where r.userNo = u.userNo
		]]>
		
		 <if test=" keyword != null and keyword !='' ">
			and r.reviewTitle || u.nickname like '%' || #{keyword} ||'%'
		</if>
		
		<![CDATA[
						order by r.reviewNo desc)ot)rt
			where rn >= #{startRnum}
			and rn <= #{endRnum}
		]]>
	</select>

	<!-- 2021.10.01 by 원호 -->
	<!-- 전체 게시물 갯수 구하기 -->
		<select id = "selectTotalCnt" parameterType = "String" resultType = "int">
		<![CDATA[
			select count(*)
			from review r, users u
			where r.userNo = u.userNo
		]]>
		<if test = "_parameter != null and _parameter != '' ">
			and r.reviewTitle || u.nickname like '%' || #{keyword} ||'%'
		</if>
	</select>
	
	
	
	<!-- 2021.09.30 by 원호 -->
	<!-- 후기게시판 글등록 -->
		<insert id="reviewBoardInsert" parameterType = "ReviewBoardVo"> 
			<![CDATA[ 
				insert into review
				values ( reviewNo.nextval
				        ,#{themeNo}
				        ,#{userNo}
				        ,#{feelLevel}
				        ,#{rating}
				        ,#{recTime}
				        ,#{reviewHints}
				        ,#{reviewClear}
				        ,#{memberNum}
				        ,sysdate
				        ,sysdate
				        ,#{reviewLike}
				        ,#{reviewTitle}
				        ,#{reviewContent}
				        ,#{reviewHit}
				        ,#{reviewImg}
				        )	
			]]> 
		</insert>


	<!-- 2021.09.29 by 원호 -->
	<!-- sido사용 cafeNo, cafeName 가져오기 -->
	<select id="cafeListSelect" parameterType="String" resultType="ReviewBoardVo">
		<![CDATA[
			select cafeNo,
				   cafeName
			from cafe
			where (sidodetail like '%' || #{sido} || '%'
			OR sido like '%' || #{sido} || '%')
		]]>
	</select>

	<!-- 2021.09.29 by 원호 -->
	<!-- cafeNo로 테마NO, 테마이름가져오기 -->
	<select id="themeListSelect" parameterType="int" resultType="ReviewBoardVo">
		<![CDATA[
			select themeNo,
       			   themename
			from theme
			where cafeNo = #{cafeNo}
		]]>
	</select>

	<!-- 2021.10.02 by 원호 -->
	<!-- 조회수올리기 -->
	<update id="hit" parameterType="int">
		<![CDATA[
			update review
			set reviewhit = reviewhit+1
			where reviewno = #{reviewno}
		]]>
	</update>
	
	
	<!-- 2021.10.02 by 원호 -->
	<!-- 글 1개 정보 가져오기 -->
	<select id="selectBoard" parameterType="int" resultType = "ReviewBoardVo">
		<![CDATA[
			select  r.reviewno,
					r.userNo,
       				r.reviewtitle,
			        u.nickname,
			        r.reviewhit,
			        to_char(r.reviewregdate, 'yy-mm-dd') reviewregdate,	
			        r.reviewcontent,
			        r.reviewhints,
			        r.reviewClear,
			        r.recTime,
			        r.memberNum,
			        r.reviewImg,
	                t.themeName
			from review r, users u, theme t
			where r.userNo = u.userNo
			and r.themeNo = t.themeNo
			and r.reviewno = #{reviewno}
		]]>
	</select>
	
	<!-- 2021.10.06 by 원호-->
	<!-- 게시글 삭제 -->
	<delete id = "reviewDelete" parameterType = "int">
		<![CDATA[
			delete from review
			where reviewNo = #{reviewNo}
		]]>
	</delete>
	
	
	<!-- 2021.10.06 by 원호 -->
	<!-- 게시글 수정 -->
	<update id="reviewModify" parameterType = "int">
		update review
		set  reviewTitle = #{reviewTitle}
		    ,reviewContent = #{reviewContent}
		    ,themeNo = #{themeNo}
		    ,feelLevel = #{feelLevel}
		    ,rating = #{rating}
		    ,recTime = #{recTime}
		    ,reviewHints = #{reviewHints}
		    ,reviewClear = #{reviewClear}
		    ,memberNum = #{memberNum}
		    ,playDate = sysdate
		    ,reviewRegDate = sysdate
		    ,reviewLike = #{reviewLike}
		    ,reviewHit = #{reviewHit}
		    ,reviewImg = #{reviewImg}
		where reviewNo = #{reviewNo}
		and userNo= #{userNo}
	</update>
</mapper>