<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reviewBoard">

	<!-- 2021.09.30 by 원호 -->
	<!-- 후기게시판 리스트 -->
	<select id = "reviewBoardList" parameterType = "Map" resultType = "ReviewBoardVo">
		<![CDATA[
			select  rt.rn,
					rt.reviewNo,
			        rt.reviewTitle,
			        rt.nickname,
			        rt.reviewhit,
			        rt.reviewLike,
			        rt.reviewregdate
			from (select  rownum rn,
						  ot.reviewNo,
			              ot.reviewTitle,
			              ot.nickname,
			              ot.reviewhit,
			              ot.reviewLike,
			              ot.reviewregdate
			      from (select  r.reviewNo,
			      				r.reviewTitle,
			                    u.nickname,
			                    r.reviewhit,
			                    r.reviewLike,
			                    to_char(r.reviewregdate, 'yy-mm-dd') reviewregdate
			            from review r, users u
			            where r.userNo = u.userNo
		]]>
		
		 <if test=" keyword != null and keyword !='' ">
			and r.reviewTitle || u.nickname like '%' || #{keyword} ||'%'
		</if>
		
		<![CDATA[
						order by r.reviewNo desc)ot)rt
			where rn >= #{startRnum}
			and rn <= #{endRnum}
		]]>
	</select>

	<!-- 2021.10.01 by 원호 -->
	<!-- 전체 게시물 갯수 구하기 -->
		<select id = "selectTotalCnt" parameterType = "String" resultType = "int">
		<![CDATA[
			select count(*)
			from review r, users u
			where r.userNo = u.userNo
		]]>
		<if test = "_parameter != null and _parameter != '' ">
			and r.reviewTitle || u.nickname like '%' || #{keyword} ||'%'
		</if>
	</select>
	
	
	
	<!-- 2021.09.30 by 원호 -->
	<!-- 후기게시판 글등록 -->
		<insert id="reviewBoardInsert" parameterType = "ReviewBoardVo"> 
			<![CDATA[ 
				insert into review
				values ( reviewNo.nextval
				        ,#{themeNo}
				        ,#{userNo}
				        ,#{feelLevel}
				        ,#{rating}
				        ,#{recTime}
				        ,#{reviewHints}
				        ,#{reviewClear}
				        ,#{memberNum}
				        ,sysdate
				        ,sysdate
				        ,#{reviewLike}
				        ,#{reviewTitle}
				        ,#{reviewContent}
				        ,#{reviewHit}
				        )	
			]]> 
		</insert>


	<!-- 2021.09.29 by 원호 -->
	<!-- sido사용 cafeNo, cafeName 가져오기 -->
	<select id="cafeListSelect" parameterType="String" resultType="ReviewBoardVo">
		<![CDATA[
			select cafeNo,
				   cafeName
			from cafe
			where (sidodetail like '%' || #{sido} || '%'
			OR sido like '%' || #{sido} || '%')
		]]>
	</select>

	<!-- 2021.09.29 by 원호 -->
	<!-- cafeNo로 테마NO, 테마이름가져오기 -->
	<select id="themeListSelect" parameterType="int" resultType="ReviewBoardVo">
		<![CDATA[
			select themeNo,
       			   themename
			from theme
			where cafeNo = #{cafeNo}
		]]>
	</select>

	<!-- 2021.10.02 by 원호 -->
	<!-- 조회수올리기 -->
	<update id="hit" parameterType="int">
		<![CDATA[
			update review
			set reviewhit = reviewhit+1
			where reviewno = #{reviewno}
		]]>
	</update>
	
	
	<!-- 2021.10.02 by 원호 -->
	<!-- 글 1개 정보 가져오기 -->
	<select id="selectBoard" parameterType="int" resultType = "ReviewBoardVo">
		<![CDATA[
			select  r.reviewno,
       				r.reviewtitle,
			        u.nickname,
			        r.reviewhit,
			         to_char(r.reviewregdate, 'yy-mm-dd') reviewregdate,	
			        r.reviewcontent	
			from review r, users u
			where r.userNo = u.userNo
			and r.reviewno = #{reviewno}
		]]>
	</select>
</mapper>