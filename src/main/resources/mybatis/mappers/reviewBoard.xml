<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reviewBoard">

	<!-- 2021.09.30 by 원호 -->
	<!-- 후기게시판 리스트 -->
	<select id = "reviewBoardList" parameterType = "Map" resultType = "ReviewBoardVo">
		<![CDATA[
			select  rt.rn,
			        rt.reviewTitle,
			        rt.nickname,
			        rt.reviewhit,
			        rt.reviewLike,
			        rt.reviewregdate
			from (select  rownum rn,
			              ot.reviewTitle,
			              ot.nickname,
			              ot.reviewhit,
			              ot.reviewLike,
			              ot.reviewregdate
			      from (select  r.reviewTitle,
			                    u.nickname,
			                    r.reviewhit,
			                    r.reviewLike,
			                    to_char(r.reviewregdate, 'yy-mm-dd') reviewregdate
			            from review r, users u
			            where r.userNo = u.userNo
		]]>
		
		 <if test=" value != null and value !='' ">
			and r.reviewTitle || u.nickname like '%' || #{keyword} ||'%'
		</if>
		
		<![CDATA[
			order by r.reviewNo desc)ot )rt
			where rn>1
			and rn<10
		]]>
	</select>

	<!-- 2021.09.30 by 원호 -->
	<!-- 후기게시판 글등록 -->
		<insert id="reviewBoardInsert" parameterType = "ReviewBoardVo"> 
			<![CDATA[ 
				insert into review
				values ( reviewNo.nextval
				        ,#{themeNo}
				        ,#{userNo}
				        ,#{feelLevel}
				        ,#{rating}
				        ,#{recTime}
				        ,#{reviewHints}
				        ,#{reviewClear}
				        ,#{memberNum}
				        ,sysdate
				        ,sysdate
				        ,#{reviewLike}
				        ,#{reviewTitle}
				        ,#{reviewContent}
				        ,#{reviewHit}
				        )	
			]]> 
		</insert>


	<!-- 2021.09.29 by 원호 -->
	<!-- sido사용 cafeNo, cafeName 가져오기 -->
	<select id="cafeListSelect" parameterType="String" resultType="ReviewBoardVo">
		<![CDATA[
			select cafeNo,
				   cafeName
			from cafe
			where (sidodetail like '%' || #{sido} || '%'
			OR sido like '%' || #{sido} || '%')
		]]>
	</select>

	<!-- 2021.09.29 by 원호 -->
	<!-- cafeNo로 테마NO, 테마이름가져오기 -->
	<select id="themeListSelect" parameterType="int" resultType="ReviewBoardVo">
		<![CDATA[
			select themeNo,
       			   themename
			from theme
			where cafeNo = #{cafeNo}
		]]>
	</select>

</mapper>