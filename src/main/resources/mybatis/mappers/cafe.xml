<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cafe">

	
	<!-- 카페 추가 및 카페번호 가져오기 -->
	<insert id="addCafeKey" parameterType="com.nextroom.vo.CafeVo">
		<selectKey keyProperty="cafeNo" resultType="int" order="BEFORE">
			select cafeNo.nextval from dual
		</selectKey>
		<![CDATA[	
			insert into cafe
				values (#{cafeNo}, 
						#{userNo}, 
						#{cafeName}, 
						#{cafeHp}, 
						#{openTime}, 
						#{closeTime}, 
						#{cafeIntro}, 
						#{url}, 
						#{cafeImg},
						#{postCode},
						#{address}, 
						#{addressDetail},  
						#{printAddress}, 
						#{sido}, 
						#{sigungu},
						#{sidoDetail},
						#{latitude},
						#{longitude}
						)
	    	]]>
	</insert>



	<!-- 카페 수정 -->
	<update id="updateCafe" parameterType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
				update cafe
				set cafeImg = #{cafeImg}
					
				where cafeNo = #{no}
			]]>

	</update>
	
	
	<!-- 유저 타입 수정 -->
	<update id="updateUser" parameterType="int">
		<![CDATA[
				update users
				set userType = 2
				where userNo = #{userNo}
			]]>
	</update>

	<!-- 카페 내부이미지 추가 -->
	<insert id="addInteriorImg" parameterType="Map"> 
		<![CDATA[ 
				insert into interiorImg 
				values (
						#{cafeNo},
						#{intePath}
				) ]]>
	</insert>
	
	<!-- 카페 한개 정보 가져오기 -->
	<select id="getCafe" parameterType="int" resultType="com.nextroom.vo.CafeVo">
		<![CDATA[
			select cafeName, cafeHp, openTime, closeTime, 
				   cafeIntro, url, cafeImg, postCode, address, addressDetail, sido, sigungu, sidoDetail, latitude, longitude
			from cafe
			where cafeNo = #{cafeNo}
		]]>
	
	</select>
	
	<!-- 카페 내부이미지 리스트 가져오기 -->
	<select id="getInteList" parameterType="int" resultType="com.nextroom.vo.InteriorVo">
		<![CDATA[
			select img
			from INTERIORIMG
			where cafeNo = #{cafeNo}
		]]>
	
	</select>
	
	
	<!-- 카페 전체 리스트 가져오기 -->
	<select id="getCafeList" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select cafeNo, cafeName, cafeHp, openTime, closeTime, 
				   cafeIntro, cafeImg, printAddress, sidoDetail
			from cafe
		]]>
	
	</select>
	
	
	
	<!-- 카페 상세 정보 가져오기 -->
	<select id="getOneCafe" parameterType="int" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select cafeNo, cafeName, cafeHp, openTime, closeTime, 
				   cafeIntro, cafeImg, printAddress, sidoDetail
			from cafe
			where cafeNo = #{cafeNo}
		]]>
	
	</select>
	
	
	
	<!-- 테마 추가 -->
	<insert id="addTheme" parameterType="com.nextroom.vo.CafeVo"> 
		
		<selectKey keyProperty="themeNo" resultType="int" order="BEFORE">
			select themeNo.nextval from dual
		</selectKey>
		
		<![CDATA[ 
				insert into theme
				values (
						#{themeNo},
						#{cafeNo},
						#{themeName},
						#{themeImg},
						#{jenre},
						#{levels},
						#{themeType},
						#{playTime},
						#{activity},
						#{themeIntro},
						#{pRecommendMin},
						#{pRecommendMax},
						#{pMin},
						#{pMax}
				) ]]>
	</insert>
	
	<!-- 테마 가격 추가 -->
	<insert id="addThemePrice" parameterType="com.nextroom.vo.PriceVo"> 
		<![CDATA[ 
				insert into  
				values (
						#{themeNo},
						#{headCount},
						#{price}
				) ]]>
	</insert>
	
	<!-- 테마 시간표 추가 -->
	<insert id="addThemeTime" parameterType="com.nextroom.vo.TimeVo"> 
		<![CDATA[ 
				insert into  
				values (
						themeTimeNo.nextval,
						#{themeNo},
						#{themeTime}
				) ]]>
	</insert>

</mapper>