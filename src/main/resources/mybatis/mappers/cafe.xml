<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cafe">


	<!-- 카페 추가 및 카페번호 가져오기 -->
	<insert id="addCafeKey" parameterType="com.nextroom.vo.CafeVo">
		<selectKey keyProperty="cafeNo" resultType="int" order="BEFORE">
			select cafeNo.nextval from dual
		</selectKey>
		<![CDATA[	
			insert into cafe
				values (#{cafeNo}, 
						#{userNo}, 
						#{cafeName}, 
						#{cafeHp}, 
						#{openTime}, 
						#{closeTime}, 
						#{cafeIntro}, 
						#{url}, 
						#{cafeImg},
						#{postCode},
						#{address}, 
						#{addressDetail},  
						#{printAddress}, 
						#{sido}, 
						#{sigungu},
						#{sidoDetail},
						#{latitude},
						#{longitude}
						)
	    	]]>
	</insert>



	<!-- 카페 수정 -->
	<update id="updateCafe" parameterType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
				update cafe
				set cafeImg = #{cafeImg}
					
				where cafeNo = #{no}
			]]>

	</update>


	<!-- 유저 타입 수정 -->
	<update id="updateUser" parameterType="int">
		<![CDATA[
				update users
				set userType = 2
				where userNo = #{userNo}
			]]>
	</update>

	<!-- 카페 내부이미지 추가 -->
	<insert id="addInteriorImg" parameterType="com.nextroom.vo.InteriorVo"> 
		<![CDATA[ 
				insert into interiorImg 
				values (
						#{cafeNo},
						#{img}
				) ]]>
	</insert>

	<!-- 카페 한개 정보 가져오기 -->
	<select id="getCafe" parameterType="int" resultType="com.nextroom.vo.CafeVo">
		<![CDATA[
			select cafeName, cafeHp, openTime, closeTime, 
				   cafeIntro, url, cafeImg, postCode, address, addressDetail, printAddress, sido, sigungu, sidoDetail, latitude, longitude
			from cafe
			where cafeNo = #{cafeNo}
		]]>

	</select>

	<!-- 카페 내부이미지 리스트 가져오기 -->
	<select id="getInteList" parameterType="int" resultType="com.nextroom.vo.InteriorVo">
		<![CDATA[
			select img
			from INTERIORIMG
			where cafeNo = #{cafeNo}
		]]>

	</select>


	<!-- 카페 전체 리스트 가져오기 -->
	<select id="getCafeList" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select cafeNo, cafeName, cafeHp, openTime, closeTime, 
				   cafeIntro, cafeImg, printAddress, sidoDetail
			from cafe
		]]>

	</select>



	<!-- 카페 상세 정보 가져오기 -->
	<select id="getOneCafe" parameterType="int" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select cafeNo, cafeName, cafeHp, openTime, closeTime, 
				   cafeIntro, cafeImg, printAddress, sidoDetail
			from cafe
			where cafeNo = #{cafeNo}
		]]>

	</select>



	<!-- 테마 추가 -->
	<insert id="addTheme" parameterType="com.nextroom.vo.CafeVo">

		<selectKey keyProperty="themeNo" resultType="int" order="BEFORE">
			select themeNo.nextval from dual
		</selectKey>
		
		<![CDATA[ 
				insert into theme
				values (
						#{themeNo},
						#{cafeNo},
						#{themeName},
						#{themeImg},
						#{jenre},
						#{levels},
						#{themeType},
						#{playTime},
						#{activity},
						#{themeIntro},
						#{pRecommendMin},
						#{pRecommendMax},
						#{pMin},
						#{pMax}
				) ]]>
	</insert>

	<!-- 테마 가격 추가 -->
	<insert id="addThemePrice" parameterType="com.nextroom.vo.PriceVo"> 
		<![CDATA[ 
				insert into themePrice
				values (
						#{themeNo},
						#{headCount},
						#{price}
				) ]]>
	</insert>



	<!-- 테마 시간표 추가 -->
	<insert id="addThemeTime" parameterType="com.nextroom.vo.TimeVo"> 
		<![CDATA[ 
				insert into themeTime
				values (
						themeTimeNo.nextval,
						#{themeNo},
						#{themeTime}
				) ]]>
	</insert>




	<!-- 카페 내 전체 테마 정보 가져오기 -->
	<select id="getCafeTheme" parameterType="int" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select  c.cafeName,
					th.THEMENO, 
					th.THEMENAME,
					th.THEMEIMG,
					th.JENRE,
					th.LEVELS,
					th.THEMETYPE,
					th.PLAYTIME,
					th.ACTIVITY,
					th.THEMEINTRO,
					th.PRECOMMENDMIN,
					th.PRECOMMENDMAX,
					th.pMin,
					th.pMax
			from cafe c, theme th
			where c.cafeNo = th.cafeNo
			and c.cafeNo = #{cafeNo}
		]]>

	</select>




	<!-- 전체 테마 가격 가져오기 -->
	<select id="getAllPrice" parameterType="com.nextroom.vo.CafeVo" resultType="com.nextroom.vo.PriceVo">
	
		<![CDATA[
			select  th.themeName,
					th.PLAYTIME,
					p.THEMENO,
					p.HEADCOUNT,
					p.PRICE
			from cafe c, theme th, themePrice p
			where c.cafeNo = th.cafeNo
			and th.themeNo = p.themeNo
			and c.cafeNo = #{cafeNo}
			and p.HEADCOUNT = #{pMin}
		]]>

	</select>

	<!-- 전체 테마 가격 가져오기 -->
	<select id="aaa" parameterType="int" resultType="com.nextroom.vo.PriceVo">
	
		<![CDATA[
			select  th.themeName,
					th.playTime,
					p.themeNo,
					p.headCount,
					p.price
			from cafe c, theme th, themePrice p
			where c.cafeNo = th.cafeNo
			and th.themeNo = p.themeNo
			and c.cafeNo = #{cafeNo}
		]]>

	</select>


	<!-- 테마 리뷰 체감난이도, 별점 가져오기 -->
	<select id="getRating" parameterType="int" resultType="com.nextroom.vo.ReviewBoardVo">
	
		<![CDATA[
			select r.feellevel, r.rating
			from cafe c, theme th, review r
			where c.cafeNo = th.cafeNo
			and th.themeNo = r.themeNo
			and c.cafeNo = #{cafeNo}
		]]>

	</select>

	<!-- 테마 전체 최대최소인원 가져오기 -->
	<select id="getMinMaxP" parameterType="int" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select min(pMin)minPMin, max(pMax) maxPMax
			from theme
			where cafeNo = #{cafeNo}
		]]>

	</select>

	<!-- 테마당 인원별 가격 한개 가져오기 -->
	<select id="getPriceOne" parameterType="com.nextroom.vo.PriceVo" resultType="Integer">
	
		<![CDATA[
			select p.price
			from themePrice p,theme th
			where th.themeNo = p.themeNo
			and th.themeNo = #{themeNo}
			and p.headCount = #{headCount}
			
		]]>

	</select>

	<!-- 테마 한개 정보 가져오기 -->
	<select id="getOneTheme" parameterType="int" resultType="com.nextroom.vo.CafeVo">
	
		<![CDATA[
			select 	c.cafeName,
					c.cafeNo,
					th.THEMENO, 
					th.THEMENAME,
					th.THEMEIMG,
					th.JENRE,
					th.LEVELS,
					th.THEMETYPE,
					th.PLAYTIME,
					th.ACTIVITY,
					th.THEMEINTRO,
					th.PRECOMMENDMIN,
					th.PRECOMMENDMAX,
					th.pMin,
					th.pMax
			from cafe c, theme th
			where c.cafeNo = th.cafeNo
			and th.themeNo = #{themeNo}
			
		]]>

	</select>


	<!-- 테마 한개 시간표 가져오기 -->
	<select id="getOneTime" parameterType="int" resultType="com.nextroom.vo.TimeVo">
	
		<![CDATA[
			select  t.THEMETIMENO,
					t.THEMETIME
			from theme th, themeTime t
			where th.themeNo = t.themeNo
			and th.themeNo = #{themeNo}
			order by t.THEMETIME asc
		]]>

	</select>


	<!-- 테마 한개 가격표 가져오기 -->
	<select id="getOnePrice" parameterType="int" resultType="com.nextroom.vo.PriceVo">
	
		<![CDATA[
			select  th.themeName,
					th.playTime,
					p.themeNo,
					p.headCount,
					p.price
			from cafe c, theme th, themePrice p
			where c.cafeNo = th.cafeNo
			and th.themeNo = p.themeNo
			and th.themeNo = #{themeNo}
			order by p.headCount asc
			
		]]>

	</select>

	<!-- 테마 한개 리뷰 가져오기 -->
	<select id="getReviewList" parameterType="int" resultType="com.nextroom.vo.ReviewBoardVo">
	
		<![CDATA[
			select  r.REVIEWNO,
					r.THEMENO,
					r.USERNO,
					r.FEELLEVEL,
					r.RATING,
					r.RECTIME,
					r.REVIEWHINTS,
					r.REVIEWCLEAR,
					r.MEMBERNUM,
					r.PLAYDATE,
					r.REVIEWREGDATE,
					r.REVIEWLIKE,
					r.REVIEWTITLE,
					r.REVIEWCONTENT,
					r.REVIEWHIT,
					u.NICKNAME 
			from review r, users u
			where r.userNo = u.userNo
			and r.themeNo = #{themeNo}
		]]>

	</select>

	<!-- 테마 한개 리뷰 개수 가져오기 -->
	<select id="getReviewCount" parameterType="int" resultType="int">
	
		<![CDATA[
			
		select  count(r.REVIEWNO )
		from review r, users u
		where r.userNo = u.userNo
		and r.themeNo = #{themeNo}
		
		]]>

	</select>



</mapper>