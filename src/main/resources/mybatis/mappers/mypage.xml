<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mypage">

	<!-- 마이페이지 파티관리 -->
	<select id="mypagePartyManage" parameterType="map" resultType="com.nextroom.vo.PartyVo">
		<![CDATA[
			select rt.rn,
			       rt.partyNo,
			       rt.userNo,
			       rt.reservedateno,
			       rt.reserveDate,
			       rt.cafeno,
			       rt.themeno,
			       rt.themetime,
			       rt.reservePerson,
			       rt.content,
			       rt.partyState
			from ( select rownum rn,
			              ot.partyNo,
			              ot.userNo,
			              ot.reservedateno,
			              ot.reserveDate,
			              ot.cafeno,
			              ot.themeno,
			              ot.themetime,
			              ot.reservePerson,
			              ot.content,
			              ot.partyState
			       from ( select p.partyNo,
			                     p.userNo,
			                     p.reservedateno,
			                     to_char(reservedate, 'YY-MM-DD') reserveDate,
			                     p.cafeno,
			                     p.themeno,
			                     p.themetime,
			                     p.reserveperson,
			                     p.content,
			                     p.partyState
			              from party p , partyDetail pd
			              where p.partyNo = pd.partyno
			              and pd.userno = #{userNo}
		]]>
		
		<choose>
			<when test="partyJoinSelect.equals('makeParty')">
			              and pd.userstate = '2'
			</when>
			<when test="partyJoinSelect.equals('joinParty')">
						  and pd.userstate = '1'
			</when>
			<otherwise>
						  
			</otherwise>
		</choose>
		<![CDATA[
			              order by p.partyNo desc ) ot ) rt
			where rn >= #{startRnum}
			and rn <= #{endRnum}
		]]>
	</select>
	

</mapper>